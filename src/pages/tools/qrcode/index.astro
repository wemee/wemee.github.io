---
import BaseLayout from '@/layouts/BaseLayout.astro';
import Navbar from '@/components/Navbar.astro';
---
<BaseLayout 
  title="QR Code åœ–ç‰‡è§£æå™¨ | æŒ«å±å‹‡çš„å¯¦ç”¨å·¥å…·" 
  description="æ‰‹æ©Ÿåªæœ‰ä¸€å°ï¼Œç•«é¢å»å‡ºç¾ QR Code è¦ä½ æƒï¼Ÿåˆ¥å†å€Ÿåˆ¥äººæ‰‹æ©Ÿä¾†ç¿»æ‹äº†ï¼ç›´æ¥æˆªåœ–ä¸Šå‚³ï¼Œé€™å€‹å·¥å…·å¹«ä½ è§£æå‡ºç¶²å€ã€‚"
>
  <Navbar currentPage="qrcode" />
  <div class="container mt-5">
    <h1 class="mb-3">æŒ«å±å‹‡ã„Ÿç·šä¸Š QR Code è§£æå™¨</h1>
    
    <!-- é–‹ç™¼æ•…äº‹ -->
    <div class="alert alert-info border-0 shadow-sm mb-4">
      <h5 class="alert-heading fw-bold">ğŸ˜¡ ç‚ºä»€éº¼æœƒæœ‰é€™å€‹å·¥å…·ï¼Ÿ</h5>
      <p class="mb-0">
        ä½ æ˜¯å¦é‡éé€™ç¨®ç‹€æ³ï¼Ÿç”¨æ‰‹æ©Ÿç€è¦½ç¶²é æˆ– Lineï¼Œçµæœå°æ–¹çµ¦ä½ ä¸€å€‹ QR Code è¦ä½ æƒæ...<br>
        <strong>æ‹œè¨—ï¼æˆ‘å°±åªæœ‰é€™æ”¯æ‰‹æ©Ÿï¼Œæ˜¯è¦æˆ‘æ€éº¼æƒè‡ªå·±çš„è¢å¹•å•¦ï¼Ÿ</strong>ğŸ˜ <br>
        é›£é“è¦è„«è¤²å­æ”¾å±æ‰¾æœ‹å‹çš„æ‰‹æ©Ÿä¾†æ‹æˆ‘çš„è¢å¹•ï¼Œå†ç”¨æˆ‘çš„æ‰‹æ©Ÿå»æƒä»–çš„ç…§ç‰‡ï¼Ÿå¤ªç™½ç™¡äº†å§ï¼<br>
        æ‰€ä»¥æˆ‘å°±åšäº†é€™å€‹å·¥å…·ï¼š<strong>ç›´æ¥æˆªåœ–ä¸Šå‚³ï¼Œé‚„ä½ åŸæœ¬çš„ç¶²å€ã€‚</strong> æ”¶å·¥ã€‚
      </p>
    </div>

    <p class="mb-4">ğŸ‘‡ è«‹ä¸Šå‚³åŒ…å« QR Code çš„åœ–ç‰‡æˆ–æˆªåœ–</p>

    <div class="mb-4">
      <label for="fileInput" class="form-label">ä¸Šå‚³åœ–ç‰‡ä»¥è§£æ QR Code</label>
      <input class="form-control" type="file" id="fileInput" accept="image/*">
    </div>

    <!-- åœ–ç‰‡é è¦½ -->
    <div class="mb-4 text-center">
      <img id="preview" class="img-fluid rounded shadow-sm d-none" alt="åœ–åƒé è¦½">
    </div>

    <!-- éš±è—ç”¨ Canvas -->
    <canvas id="canvas" class="d-none"></canvas>

    <div class="card">
      <div class="card-body">
        <h5 class="card-title">è§£æçµæœ</h5>
        <p id="result" class="card-text text-muted">å°šæœªè§£æä»»ä½• QR Codeã€‚</p>
      </div>
    </div>
  </div>
</BaseLayout>

<script is:inline src="/tools/qrcode/jsQR.min.js"></script>
<script is:inline>
  var fileInput = document.getElementById('fileInput');
  var preview = document.getElementById('preview');
  var canvas = document.getElementById('canvas');
  var ctx = canvas.getContext('2d');
  var resultDiv = document.getElementById('result');

  fileInput.addEventListener('change', function(e) {
    var file = e.target.files && e.target.files[0];
    if (!file) return;

    var url = URL.createObjectURL(file);
    preview.src = url;
    preview.classList.remove('d-none');

    var img = new Image();
    img.onload = function() {
      canvas.width = img.width;
      canvas.height = img.height;
      ctx.drawImage(img, 0, 0);

      var imgData = ctx.getImageData(0, 0, img.width, img.height);
      var code = jsQR(imgData.data, imgData.width, imgData.height);

      resultDiv.textContent = code
        ? code.data
        : "æœªåµæ¸¬åˆ° QR Codeã€‚";

      URL.revokeObjectURL(url);
    };
    img.src = url;
  });
</script>
