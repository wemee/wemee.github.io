---
interface Props {
  currentPage?: string;
}
const { currentPage = '' } = Astro.props;

const navItems = [
  {
    label: 'æ•¸å­¸å·¥å…·',
    key: 'math',
    items: [
      { href: '/math/', label: 'ğŸ“ å…¨éƒ¨å·¥å…·' },
      { divider: true },
      { href: '/math/gcdlcm', label: 'ğŸ§® æ•¸å­¸è¨ˆç®—å™¨' },
      { href: '/math/fourier', label: 'ğŸ¨ å‚…ç«‹è‘‰ç•«ç•«' },
      { href: '/math/waveform', label: 'ğŸ›ï¸ æ³¢å½¢åˆæˆå™¨' },
      { href: '/math/dot-product', label: 'ğŸ¹ å‘é‡å…§ç©è¦–è¦ºåŒ–' },
      { href: '/math/traffic', label: 'ğŸš— äº¤é€šæµé«”åŠ›å­¸' },
    ]
  },
  {
    label: 'éŠæˆ²',
    key: 'game',
    items: [
      { href: '/game/', label: 'ğŸ® å…¨éƒ¨éŠæˆ²' },
      { divider: true },
      { href: '/game/stairs', label: 'ğŸƒ ä¸‹æ¨“æ¢¯' },
      { href: '/game/breakout', label: 'ğŸ§± æ‰“ç£šå¡Š' },
    ]
  },
  {
    label: 'å¯¦ç”¨å·¥å…·',
    key: 'tools',
    items: [
      { href: '/tools/', label: 'ğŸ› ï¸ å…¨éƒ¨å·¥å…·' },
      { divider: true },
      { href: '/tools/memo/', label: 'âœï¸ å…ç™»å…¥å¾…è¾¦æ¸…å–®' },
      { href: '/tools/notepad/', label: 'ğŸ“ å¿«é€Ÿè¨˜äº‹æœ¬' },
      { href: '/tools/qrcode/', label: 'ğŸ“± QR Code å·¥å…·' },
      { href: '/tools/image-lab/', label: 'ğŸ–¼ï¸ åœ–ç‰‡è™•ç†å·¥å» ' },
      { href: '/tools/id-photo/', label: 'ğŸ“· çœéŒ¢è­‰ä»¶ç…§' },
      { href: '/tools/digit-recognition/', label: 'âœï¸ æ‰‹å¯«æ•¸å­—è¾¨è­˜' },
    ]
  },
  { label: 'é—œæ–¼æˆ‘', key: 'about', href: '/about' },
  { label: 'éƒ¨è½æ ¼', key: 'blog', href: '/blog/' },
];
---

<nav class="navbar-container">
  <div class="navbar-inner">
    <div class="navbar-content">
      <!-- Brand Logo -->
      <a href="/" class="brand-logo">
        WEMEE
      </a>
      
      <!-- Desktop Navigation -->
      <div class="desktop-nav">
        {navItems.map((item) => (
          item.items ? (
            <!-- Dropdown Menu -->
            <div class="dropdown">
              <button 
                class={`nav-link ${currentPage === item.key ? 'active' : ''}`}
              >
                {item.label}
                <svg class="dropdown-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
              </button>
              <!-- Dropdown Panel -->
              <div class="dropdown-menu">
                {item.items.map((subItem) => (
                  subItem.divider ? (
                    <hr class="dropdown-divider" />
                  ) : (
                    <a href={subItem.href} class="dropdown-item">
                      {subItem.label}
                    </a>
                  )
                ))}
              </div>
            </div>
          ) : (
            <!-- Regular Link -->
            <a 
              href={item.href}
              class={`nav-link ${currentPage === item.key ? 'active' : ''}`}
            >
              {item.label}
            </a>
          )
        ))}
      </div>
      
      <!-- Mobile Menu Button -->
      <button 
        type="button" 
        class="mobile-menu-btn"
        id="mobile-menu-button"
        aria-expanded="false"
      >
        <span class="sr-only">Open main menu</span>
        <!-- Hamburger Icon -->
        <svg class="menu-icon" id="menu-icon-open" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
        <!-- Close Icon -->
        <svg class="menu-icon hidden" id="menu-icon-close" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
  </div>
  
  <!-- Mobile Menu Panel -->
  <div class="mobile-menu hidden" id="mobile-menu">
    <div class="mobile-menu-content">
      {navItems.map((item) => (
        item.items ? (
          <!-- Mobile Dropdown -->
          <div class="mobile-dropdown">
            <button 
              class={`mobile-nav-link ${currentPage === item.key ? 'active' : ''}`}
              data-dropdown-toggle
            >
              {item.label}
              <svg class="dropdown-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
              </svg>
            </button>
            <div class="mobile-dropdown-content hidden" data-dropdown-content>
              {item.items.map((subItem) => (
                !subItem.divider && (
                  <a href={subItem.href} class="mobile-dropdown-item">
                    {subItem.label}
                  </a>
                )
              ))}
            </div>
          </div>
        ) : (
          <!-- Mobile Regular Link -->
          <a 
            href={item.href}
            class={`mobile-nav-link ${currentPage === item.key ? 'active' : ''}`}
          >
            {item.label}
          </a>
        )
      ))}
    </div>
  </div>
</nav>

<style>
  /* Import Google Font for Steampunk look */
  @import url('https://fonts.googleapis.com/css2?family=Rye&display=swap');

  /* === Base Variables (using Solar theme) === */
  .navbar-container {
    background-color: #073642; /* base-800 */
    border-bottom: 1px solid #586e75; /* base-600 */
  }

  .navbar-inner {
    max-width: 80rem;
    margin: 0 auto;
    padding: 0 1rem;
  }

  @media (min-width: 640px) {
    .navbar-inner { padding: 0 1.5rem; }
  }

  @media (min-width: 1024px) {
    .navbar-inner { padding: 0 2rem; }
  }

  .navbar-content {
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 4rem;
  }

  /* === Brand Logo === */
  .brand-logo {
    font-family: 'Rye', serif;
    font-size: 1.5rem;
    font-weight: bold;
    letter-spacing: 0.1em;
    background: linear-gradient(180deg, #FFD700 20%, #DAA520 50%, #B8860B 80%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    color: #FFD700;
    text-decoration: none;
    transition: transform 0.2s ease;
  }

  .brand-logo:hover {
    transform: scale(1.05);
  }

  /* === Desktop Navigation === */
  .desktop-nav {
    display: none;
    align-items: center;
    gap: 0.25rem;
  }

  @media (min-width: 1024px) {
    .desktop-nav {
      display: flex;
    }
  }

  .nav-link {
    display: flex;
    align-items: center;
    padding: 0.5rem 0.75rem;
    font-size: 0.875rem;
    font-weight: 500;
    color: #93a1a1; /* base-400 */
    background: transparent;
    border: none;
    border-radius: 0.375rem;
    cursor: pointer;
    transition: all 0.2s;
    text-decoration: none;
  }

  .nav-link:hover {
    color: #fdf6e3; /* base-50 */
    background-color: rgba(88, 110, 117, 0.5); /* base-600/50 */
  }

  .nav-link.active {
    color: #2aa198; /* accent-cyan */
  }

  .dropdown-arrow {
    width: 1rem;
    height: 1rem;
    margin-left: 0.25rem;
    transition: transform 0.2s;
  }

  /* === Dropdown === */
  .dropdown {
    position: relative;
  }

  .dropdown-menu {
    position: absolute;
    left: 0;
    top: 100%;
    width: 14rem;
    padding: 0.5rem 0;
    margin-top: 0.25rem;
    background-color: #073642; /* base-800 */
    border: 1px solid #586e75; /* base-600 */
    border-radius: 0.5rem;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    opacity: 0;
    visibility: hidden;
    transform: translateY(-0.5rem);
    transition: all 0.2s ease;
    z-index: 50;
  }

  .dropdown:hover .dropdown-menu {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  .dropdown:hover .dropdown-arrow {
    transform: rotate(180deg);
  }

  .dropdown-item {
    display: block;
    padding: 0.5rem 1rem;
    font-size: 0.875rem;
    color: #93a1a1; /* base-400 */
    text-decoration: none;
    transition: all 0.15s;
  }

  .dropdown-item:hover {
    color: #fdf6e3; /* base-50 */
    background-color: rgba(88, 110, 117, 0.5); /* base-600/50 */
  }

  .dropdown-divider {
    margin: 0.5rem 0;
    border: none;
    border-top: 1px solid #586e75; /* base-600 */
  }

  /* === Mobile Menu Button === */
  .mobile-menu-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 0.5rem;
    color: #93a1a1; /* base-400 */
    background: transparent;
    border: none;
    border-radius: 0.375rem;
    cursor: pointer;
    transition: all 0.2s;
  }

  .mobile-menu-btn:hover {
    color: #fdf6e3; /* base-50 */
    background-color: rgba(88, 110, 117, 0.5); /* base-600/50 */
  }

  @media (min-width: 1024px) {
    .mobile-menu-btn {
      display: none;
    }
  }

  .menu-icon {
    width: 1.5rem;
    height: 1.5rem;
  }

  .menu-icon.hidden {
    display: none;
  }

  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }

  /* === Mobile Menu === */
  .mobile-menu {
    border-top: 1px solid #586e75; /* base-600 */
  }

  .mobile-menu.hidden {
    display: none;
  }

  @media (min-width: 1024px) {
    .mobile-menu {
      display: none !important;
    }
  }

  .mobile-menu-content {
    padding: 0.5rem 1rem 1rem;
  }

  .mobile-nav-link {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    padding: 0.5rem 0.75rem;
    font-size: 1rem;
    font-weight: 500;
    color: #93a1a1; /* base-400 */
    background: transparent;
    border: none;
    border-radius: 0.375rem;
    cursor: pointer;
    text-decoration: none;
    transition: all 0.2s;
  }

  .mobile-nav-link:hover {
    color: #fdf6e3; /* base-50 */
    background-color: rgba(88, 110, 117, 0.5); /* base-600/50 */
  }

  .mobile-nav-link.active {
    color: #2aa198; /* accent-cyan */
    background-color: rgba(88, 110, 117, 0.3); /* base-600/30 */
  }

  .mobile-dropdown-content {
    padding-left: 1rem;
    margin-top: 0.25rem;
  }

  .mobile-dropdown-content.hidden {
    display: none;
  }

  .mobile-dropdown-item {
    display: block;
    padding: 0.5rem 0.75rem;
    font-size: 0.875rem;
    color: #93a1a1; /* base-400 */
    text-decoration: none;
    border-radius: 0.375rem;
    transition: all 0.15s;
  }

  .mobile-dropdown-item:hover {
    color: #fdf6e3; /* base-50 */
    background-color: rgba(88, 110, 117, 0.5); /* base-600/50 */
  }

  /* Rotate arrow when dropdown is open */
  .mobile-dropdown button[aria-expanded="true"] .dropdown-arrow {
    transform: rotate(180deg);
  }
</style>

<script>
  // Mobile menu toggle
  const mobileMenuButton = document.getElementById('mobile-menu-button');
  const mobileMenu = document.getElementById('mobile-menu');
  const menuIconOpen = document.getElementById('menu-icon-open');
  const menuIconClose = document.getElementById('menu-icon-close');

  mobileMenuButton?.addEventListener('click', () => {
    const isOpen = mobileMenu?.classList.toggle('hidden') === false;
    menuIconOpen?.classList.toggle('hidden', isOpen);
    menuIconClose?.classList.toggle('hidden', !isOpen);
    mobileMenuButton.setAttribute('aria-expanded', String(isOpen));
  });

  // Mobile dropdown toggles
  document.querySelectorAll('[data-dropdown-toggle]').forEach((button) => {
    button.addEventListener('click', () => {
      const content = button.nextElementSibling;
      const icon = button.querySelector('svg');
      const isOpen = content?.classList.toggle('hidden') === false;
      button.setAttribute('aria-expanded', String(isOpen));
      if (isOpen) {
        icon?.style.setProperty('transform', 'rotate(180deg)');
      } else {
        icon?.style.setProperty('transform', 'rotate(0deg)');
      }
    });
  });
</script>
