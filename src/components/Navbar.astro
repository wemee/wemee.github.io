---
interface Props {
  currentPage?: string;
}
const { currentPage = '' } = Astro.props;

const navItems = [
  {
    label: 'æ•¸å­¸å·¥å…·',
    key: 'math',
    items: [
      { href: '/math/', label: 'ğŸ“ å…¨éƒ¨å·¥å…·' },
      { divider: true },
      { href: '/math/gcdlcm', label: 'ğŸ§® æ•¸å­¸è¨ˆç®—å™¨' },
      { href: '/math/fourier', label: 'ğŸ¨ å‚…ç«‹è‘‰ç•«ç•«' },
      { href: '/math/waveform', label: 'ğŸ›ï¸ æ³¢å½¢åˆæˆå™¨' },
      { href: '/math/dot-product', label: 'ğŸ¹ å‘é‡å…§ç©è¦–è¦ºåŒ–' },
      { href: '/math/traffic', label: 'ğŸš— äº¤é€šæµé«”åŠ›å­¸' },
    ]
  },
  {
    label: 'éŠæˆ²',
    key: 'game',
    items: [
      { href: '/game/', label: 'ğŸ® å…¨éƒ¨éŠæˆ²' },
      { divider: true },
      { href: '/game/stairs', label: 'ğŸƒ ä¸‹æ¨“æ¢¯' },
      { href: '/game/breakout', label: 'ğŸ§± æ‰“ç£šå¡Š' },
    ]
  },
  {
    label: 'å¯¦ç”¨å·¥å…·',
    key: 'tools',
    items: [
      { href: '/tools/', label: 'ğŸ› ï¸ å…¨éƒ¨å·¥å…·' },
      { divider: true },
      { href: '/tools/memo/', label: 'âœï¸ å…ç™»å…¥å¾…è¾¦æ¸…å–®' },
      { href: '/tools/notepad/', label: 'ğŸ“ å¿«é€Ÿè¨˜äº‹æœ¬' },
      { href: '/tools/qrcode/', label: 'ğŸ“± QR Code å·¥å…·' },
      { href: '/tools/image-lab/', label: 'ğŸ–¼ï¸ åœ–ç‰‡è™•ç†å·¥å» ' },
      { href: '/tools/id-photo/', label: 'ğŸ“· çœéŒ¢è­‰ä»¶ç…§' },
      { href: '/tools/digit-recognition/', label: 'âœï¸ æ‰‹å¯«æ•¸å­—è¾¨è­˜' },
    ]
  },
  { label: 'é—œæ–¼æˆ‘', key: 'about', href: '/about' },
  { label: 'éƒ¨è½æ ¼', key: 'blog', href: '/blog/' },
];
---

<nav class="tw-navbar">
  <div class="tw-navbar-inner">
    <div class="tw-navbar-content">
      <!-- Brand Logo -->
      <a href="/" class="tw-brand-logo">
        WEMEE
      </a>
      
      <!-- Desktop Navigation -->
      <div class="tw-desktop-nav">
        {navItems.map((item) => (
          item.items ? (
            <!-- Dropdown Menu -->
            <div class="tw-dropdown">
              <button 
                class={`tw-nav-link ${currentPage === item.key ? 'active' : ''}`}
              >
                {item.label}
                <svg class="tw-dropdown-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
              </button>
              <!-- Dropdown Panel -->
              <div class="tw-dropdown-menu">
                {item.items.map((subItem) => (
                  subItem.divider ? (
                    <hr class="tw-dropdown-divider" />
                  ) : (
                    <a href={subItem.href} class="tw-dropdown-item">
                      {subItem.label}
                    </a>
                  )
                ))}
              </div>
            </div>
          ) : (
            <!-- Regular Link -->
            <a 
              href={item.href}
              class={`tw-nav-link ${currentPage === item.key ? 'active' : ''}`}
            >
              {item.label}
            </a>
          )
        ))}
      </div>
      
      <!-- Mobile Menu Button -->
      <button 
        type="button" 
        class="tw-mobile-menu-btn"
        id="mobile-menu-button"
        aria-expanded="false"
      >
        <span class="tw-sr-only">Open main menu</span>
        <!-- Hamburger Icon -->
        <svg class="tw-menu-icon" id="menu-icon-open" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
        <!-- Close Icon -->
        <svg class="tw-menu-icon hidden" id="menu-icon-close" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
  </div>
  
  <!-- Mobile Menu Panel -->
  <div class="tw-mobile-menu hidden" id="mobile-menu">
    <div class="tw-mobile-menu-content">
      {navItems.map((item) => (
        item.items ? (
          <!-- Mobile Dropdown -->
          <div class="tw-mobile-dropdown">
            <button 
              class={`tw-mobile-nav-link ${currentPage === item.key ? 'active' : ''}`}
              data-dropdown-toggle
            >
              {item.label}
              <svg class="tw-dropdown-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
              </svg>
            </button>
            <div class="tw-mobile-dropdown-content hidden" data-dropdown-content>
              {item.items.map((subItem) => (
                !subItem.divider && (
                  <a href={subItem.href} class="tw-mobile-dropdown-item">
                    {subItem.label}
                  </a>
                )
              ))}
            </div>
          </div>
        ) : (
          <!-- Mobile Regular Link -->
          <a 
            href={item.href}
            class={`tw-mobile-nav-link ${currentPage === item.key ? 'active' : ''}`}
          >
            {item.label}
          </a>
        )
      ))}
    </div>
  </div>
</nav>

<script>
  // Mobile menu toggle
  const mobileMenuButton = document.getElementById('mobile-menu-button');
  const mobileMenu = document.getElementById('mobile-menu');
  const menuIconOpen = document.getElementById('menu-icon-open');
  const menuIconClose = document.getElementById('menu-icon-close');

  mobileMenuButton?.addEventListener('click', () => {
    const isOpen = mobileMenu?.classList.toggle('hidden') === false;
    menuIconOpen?.classList.toggle('hidden', isOpen);
    menuIconClose?.classList.toggle('hidden', !isOpen);
    mobileMenuButton.setAttribute('aria-expanded', String(isOpen));
  });

  // Mobile dropdown toggles
  document.querySelectorAll('[data-dropdown-toggle]').forEach((button) => {
    button.addEventListener('click', () => {
      const content = button.nextElementSibling;
      const icon = button.querySelector('svg');
      const isOpen = content?.classList.toggle('hidden') === false;
      if (icon) {
        icon.style.transform = isOpen ? 'rotate(180deg)' : 'rotate(0deg)';
      }
    });
  });
</script>
